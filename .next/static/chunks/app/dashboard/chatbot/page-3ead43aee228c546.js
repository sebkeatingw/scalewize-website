(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[969],{283:(e,t,s)=>{"use strict";s.d(t,{A:()=>c,O:()=>a});var l=s(5155),n=s(2115),r=s(5695),i=s(2409);let o=(0,n.createContext)(void 0);function a(e){let{children:t}=e,[s,a]=(0,n.useState)(null),[c,d]=(0,n.useState)(null),[u,h]=(0,n.useState)(null),[g,m]=(0,n.useState)(!0),f=(0,r.useRouter)();(0,n.useEffect)(()=>{let e=!1;!async function(){m(!0);try{var t,s;console.log("Loading session...");let{data:{session:l},error:n}=await i.N.auth.getSession();if(n&&console.error("Session error:",n),e)return;console.log("Session loaded:",(null==l||null==(t=l.user)?void 0:t.id)||"No user"),a(null!=(s=null==l?void 0:l.user)?s:null),(null==l?void 0:l.user)&&await x(l.user.id)}catch(e){console.error("Error loading session:",e)}finally{e||m(!1)}}();let{data:{subscription:t}}=i.N.auth.onAuthStateChange(async(t,s)=>{var l,n;e||(console.log("Auth state changed:",t,(null==s||null==(l=s.user)?void 0:l.id)||"No user"),a(null!=(n=null==s?void 0:s.user)?n:null),(null==s?void 0:s.user)?await x(s.user.id):(console.log("No session, clearing profile and organization"),d(null),h(null),"/login"!==window.location.pathname&&f.push("/login")),m(!1))});return()=>{e=!0,t.unsubscribe()}},[f]);let x=async e=>{try{console.log("Fetching profile for user:",e);let{data:t,error:s}=await i.N.from("profiles").select("*").eq("id",e).single();if(s){console.error("Profile fetch error:",s),console.error("Error details:",{message:s.message,details:s.details,hint:s.hint,code:s.code}),d(null),h(null);return}if(console.log("Profile fetched successfully:",t),d(t),null==t?void 0:t.organization_id){console.log("Fetching organization:",t.organization_id);let{data:e,error:s}=await i.N.from("organizations").select("*").eq("id",t.organization_id).single();s?(console.error("Organization fetch error:",s),console.error("Organization error details:",{message:s.message,details:s.details,hint:s.hint,code:s.code}),h(null)):(console.log("Organization fetched successfully:",e),h(e))}else console.log("No organization_id in profile"),h(null)}catch(e){console.error("Unexpected error in fetchProfile:",e),console.error("Error stack:",e.stack),d(null),h(null)}},y=async()=>{try{console.log("Signing out..."),await i.N.auth.signOut(),localStorage.clear(),sessionStorage.clear(),window.location.href="/login"}catch(e){console.error("Error during sign out:",e),window.location.href="/login"}};return(0,l.jsx)(o.Provider,{value:{user:s,profile:c,organization:u,loading:g,signOut:y},children:g?(0,l.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-t-2",style:{borderColor:"#595F39"}}),(0,l.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mt-4",children:"Loading ScaleWize AI"}),(0,l.jsx)("p",{className:"text-gray-600",children:"Connecting to your workspace..."})]})}):t})}function c(){let e=(0,n.useContext)(o);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},1154:(e,t,s)=>{"use strict";s.d(t,{A:()=>l});let l=(0,s(9946).A)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},2409:(e,t,s)=>{"use strict";s.d(t,{N:()=>l});let l=(0,s(2121).createBrowserClient)("https://mtybaactacapokejmtxy.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im10eWJhYWN0YWNhcG9rZWptdHh5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE3MTE5MTMsImV4cCI6MjA2NzI4NzkxM30.u9EudibnPY-rGAFX4E2TfCgyKEBa9_7a2nojUcICJGQ")},3159:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>a});var l=s(5155),n=s(2115),r=s(283),i=s(1154),o=s(2409);function a(){let{user:e,organization:t,profile:s}=(0,r.A)(),[a,c]=(0,n.useState)(""),[d,u]=(0,n.useState)(!0),[h,g]=(0,n.useState)(""),m=(0,n.useRef)(null),[f,x]=(0,n.useState)(!1),[y,p]=(0,n.useState)(!0);return(0,n.useEffect)(()=>{(async()=>{if(!e||!t)return u(!1);try{u(!0);let{data:{session:e}}=await o.N.auth.getSession(),t=null==e?void 0:e.access_token,s="https://scalewize-production-chatbot-production.up.railway.app",l=await fetch("".concat(s,"/api/auth/sso/librechat"),{method:"POST",credentials:"include",headers:t?{Authorization:"Bearer ".concat(t)}:{}});if(!l.ok)throw Error("Failed to get LibreChat session");let{libreSession:n}=await l.json();c(s.replace("http://","https://"))}catch(e){g("Failed to connect to chat service")}finally{u(!1)}})()},[e,t]),(0,n.useEffect)(()=>{let e=()=>{p("visible"===document.visibilityState)};return document.addEventListener("visibilitychange",e),()=>{document.removeEventListener("visibilitychange",e)}},[]),console.log("user:",e),console.log("organization:",t),console.log("libreChatUrl:",a),(0,l.jsx)("div",{className:"space-y-6",children:(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow",children:[(0,l.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("h3",{className:"text-lg font-medium text-gray-900",children:[(null==t?void 0:t.name)||"AI"," Chatbot"]}),(0,l.jsx)("p",{className:"text-sm text-gray-600",children:"Powered by ScaleWize AI - Connected to your business systems and databases"})]}),(0,l.jsx)("div",{className:"flex items-center space-x-2",children:(0,l.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:"Connected"})})]})}),(0,l.jsx)("div",{className:"h-[600px]",children:d?(0,l.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)(i.A,{className:"h-8 w-8 animate-spin mx-auto mb-4 text-blue-600"}),(0,l.jsx)("p",{className:"text-gray-600",children:"Connecting to chat service..."})]})}):h?(0,l.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("p",{className:"text-red-600 mb-4",children:h}),(0,l.jsx)("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Retry Connection"})]})}):a?(0,l.jsx)("iframe",{ref:m,src:"".concat(a),className:"w-full h-full rounded-b-lg",title:"ScaleWize AI Chatbot",frameBorder:"0",onLoad:()=>{x(!0)},style:{display:f?"block":"none",opacity:y?1:.99,transition:"opacity 0.2s ease-in-out"}}):(0,l.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,l.jsx)("p",{className:"text-gray-600",children:"Unable to load chat interface"})})})]})})}},8662:(e,t,s)=>{Promise.resolve().then(s.bind(s,3159))}},e=>{var t=t=>e(e.s=t);e.O(0,[864,441,684,358],()=>t(8662)),_N_E=e.O()}]);
(()=>{var e={};e.id=976,e.ids=[976],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},1630:e=>{"use strict";e.exports=require("http")},1997:e=>{"use strict";e.exports=require("punycode")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4075:e=>{"use strict";e.exports=require("zlib")},4703:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>x,routeModule:()=>d,serverHooks:()=>m,workAsyncStorage:()=>f,workUnitAsyncStorage:()=>g});var s={};t.r(s),t.d(s,{POST:()=>p});var o=t(6559),i=t(8088),a=t(7719),n=t(2190),u=t(8933);let c=process.env.SUPABASE_SERVICE_ROLE_KEY,l=(0,u.UU)("https://mtybaactacapokejmtxy.supabase.co",c,{auth:{autoRefreshToken:!1,persistSession:!1}});async function p(e){try{let{email:r,password:t,fullName:s,organizationName:o}=await e.json();if(!r||!t||!s||!o)return n.NextResponse.json({error:"Missing required fields"},{status:400});console.log("Starting signup process for:",r);let{data:i,error:a}=await l.auth.admin.createUser({email:r,password:t,email_confirm:!0,user_metadata:{full_name:s}});if(a||!i.user)return console.error("User creation error:",a),n.NextResponse.json({error:a?.message||"Failed to create user"},{status:500});let u=i.user.id;console.log("User created successfully:",u);let{data:c,error:p}=await l.from("organizations").insert({name:o,subscription_status:"trial",plan_type:"starter",max_users:50,max_chat_sessions:1e3,monthly_token_limit:1e5}).select().single();if(p||!c)return console.error("Organization creation error:",p),await l.auth.admin.deleteUser(u),n.NextResponse.json({error:"Failed to create organization"},{status:500});console.log("Organization created successfully:",c.id);let{error:d}=await l.from("profiles").insert({id:u,organization_id:c.id,email:r,full_name:s,role:"admin",status:"active",is_active:!0,onboarding_step:"completed",profile_completion_percentage:100});if(d)return console.error("Profile creation error:",d),await l.auth.admin.deleteUser(u),await l.from("organizations").delete().eq("id",c.id),n.NextResponse.json({error:"Failed to create profile: "+d.message},{status:500});console.log("Profile created successfully");let{data:f,error:g}=await l.from("profiles").select("*").eq("id",u).single();if(g||!f)return console.error("Profile verification failed:",g),n.NextResponse.json({error:"Profile created but verification failed"},{status:500});return console.log("Profile verification successful:",f),n.NextResponse.json({success:!0,message:"User, organization, and profile created successfully",data:{userId:u,organizationId:c.id,organizationName:c.name,profile:f}})}catch(e){return console.error("Signup error:",e),n.NextResponse.json({error:"Internal server error: "+e.message},{status:500})}}let d=new o.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/signup-direct/route",pathname:"/api/signup-direct",filename:"route",bundlePath:"app/api/signup-direct/route"},resolvedPagePath:"/Users/sebkeating/Documents/ScaleWize/Web Dev/scalewize-website/src/app/api/signup-direct/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:f,workUnitAsyncStorage:g,serverHooks:m}=d;function x(){return(0,a.patchFetch)({workAsyncStorage:f,workUnitAsyncStorage:g})}},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5591:e=>{"use strict";e.exports=require("https")},6487:()=>{},7910:e=>{"use strict";e.exports=require("stream")},8335:()=>{},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},9551:e=>{"use strict";e.exports=require("url")}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[447,343],()=>t(4703));module.exports=s})();
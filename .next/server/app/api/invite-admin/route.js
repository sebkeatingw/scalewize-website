(()=>{var e={};e.id=615,e.ids=[615],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},1630:e=>{"use strict";e.exports=require("http")},1997:e=>{"use strict";e.exports=require("punycode")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4075:e=>{"use strict";e.exports=require("zlib")},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5591:e=>{"use strict";e.exports=require("https")},6487:()=>{},7229:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>v,routeModule:()=>p,serverHooks:()=>m,workAsyncStorage:()=>d,workUnitAsyncStorage:()=>c});var s={};r.r(s),r.d(s,{POST:()=>l});var i=r(6559),n=r(8088),a=r(7719),o=r(2190),u=r(8933);async function l(e){try{let{email:t,organizationId:r,userId:s}=await e.json();if(console.log("Creating invitation for:",{email:t,organizationId:r,userId:s}),!t||!r||!s)return o.NextResponse.json({error:"Email, organization ID, and user ID are required"},{status:400});if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t))return o.NextResponse.json({error:"Invalid email format"},{status:400});let i=(0,u.UU)("https://mtybaactacapokejmtxy.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}}),{data:n,error:a}=await i.from("profiles").select("*").eq("id",s).eq("organization_id",r).in("role",["admin","super_admin"]).single();if(a||!n)return console.error("Admin check failed:",a),o.NextResponse.json({error:"You must be an admin to invite users"},{status:403});console.log("Admin verification successful:",n.role);let{data:l}=await i.from("profiles").select("id").eq("email",t).eq("organization_id",r).single();if(l)return o.NextResponse.json({error:"User is already a member of this organization"},{status:400});let{data:p}=await i.from("invitations").select("id").eq("email",t).eq("organization_id",r).eq("status","pending").single();if(p)return o.NextResponse.json({error:"An invitation is already pending for this email"},{status:400});let d=crypto.randomUUID(),c=new Date(Date.now()+6048e5),{data:m,error:v}=await i.from("invitations").insert({organization_id:r,email:t,invited_by:s,token:d,expires_at:c.toISOString(),status:"pending"}).select().single();if(v)return console.error("Invitation creation error:",v),o.NextResponse.json({error:"Failed to create invitation: "+v.message},{status:500});console.log("Invitation created successfully:",m.id);let{data:x}=await i.from("organizations").select("name").eq("id",r).single(),g=`http://localhost:3000/invite/${d}`;return console.log("Invitation URL created:",g),o.NextResponse.json({success:!0,message:"Invitation sent successfully",data:{id:m.id,email:m.email,expires_at:m.expires_at,invite_url:g}})}catch(e){return console.error("Admin invitation API error:",e),o.NextResponse.json({error:"Internal server error: "+e.message},{status:500})}}let p=new i.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/invite-admin/route",pathname:"/api/invite-admin",filename:"route",bundlePath:"app/api/invite-admin/route"},resolvedPagePath:"/Users/sebkeating/Documents/ScaleWize/Web Dev/scalewize-website/src/app/api/invite-admin/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:d,workUnitAsyncStorage:c,serverHooks:m}=p;function v(){return(0,a.patchFetch)({workAsyncStorage:d,workUnitAsyncStorage:c})}},7910:e=>{"use strict";e.exports=require("stream")},8335:()=>{},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},9551:e=>{"use strict";e.exports=require("url")}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[447,343],()=>r(7229));module.exports=s})();
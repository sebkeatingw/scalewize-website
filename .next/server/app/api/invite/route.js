(()=>{var e={};e.id=133,e.ids=[133],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},27910:e=>{"use strict";e.exports=require("stream")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},34631:e=>{"use strict";e.exports=require("tls")},39727:()=>{},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},47990:()=>{},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},55684:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>v,routeModule:()=>l,serverHooks:()=>m,workAsyncStorage:()=>c,workUnitAsyncStorage:()=>x});var s={};r.r(s),r.d(s,{POST:()=>d});var i=r(96559),a=r(48088),n=r(37719),o=r(32190),u=r(61223),p=r(44999);async function d(e){try{let{email:t,organizationId:r}=await e.json();if(!t||!r)return o.NextResponse.json({error:"Email and organization ID are required"},{status:400});if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t))return o.NextResponse.json({error:"Invalid email format"},{status:400});let s=await (0,p.UL)(),i=(0,u.createRouteHandlerClient)({cookies:async()=>s}),{data:{user:a},error:n}=await i.auth.getUser();if(n||!a)return o.NextResponse.json({error:"Unauthorized"},{status:401});let{data:d,error:l}=await i.from("profiles").select("*").eq("id",a.id).eq("organization_id",r).in("role",["admin","super_admin"]).single();if(l||!d)return o.NextResponse.json({error:"You must be an admin to invite users"},{status:403});let{data:c}=await i.from("profiles").select("id").eq("email",t).eq("organization_id",r).single();if(c)return o.NextResponse.json({error:"User is already a member of this organization"},{status:400});let{data:x}=await i.from("invitations").select("id").eq("email",t).eq("organization_id",r).eq("status","pending").single();if(x)return o.NextResponse.json({error:"An invitation is already pending for this email"},{status:400});let m=crypto.randomUUID(),v=new Date(Date.now()+6048e5),{data:g,error:f}=await i.from("invitations").insert({organization_id:r,email:t,invited_by:a.id,token:m,expires_at:v.toISOString(),status:"pending"}).select().single();if(f)return console.error("Invitation creation error:",f),o.NextResponse.json({error:"Failed to create invitation"},{status:500});let{data:q}=await i.from("organizations").select("name").eq("id",r).single(),w=`http://localhost:3000/invite/${m}`;return o.NextResponse.json({success:!0,message:"Invitation sent successfully",data:{id:g.id,email:g.email,expires_at:g.expires_at,invite_url:w}})}catch(e){return console.error("Invitation API error:",e),o.NextResponse.json({error:"Internal server error"},{status:500})}}let l=new i.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/invite/route",pathname:"/api/invite",filename:"route",bundlePath:"app/api/invite/route"},resolvedPagePath:"/Users/sebkeating/Documents/ScaleWize/Web Dev/scalewize-website/src/app/api/invite/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:c,workUnitAsyncStorage:x,serverHooks:m}=l;function v(){return(0,n.patchFetch)({workAsyncStorage:c,workUnitAsyncStorage:x})}},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{"use strict";e.exports=require("zlib")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[447,580,437,605],()=>r(55684));module.exports=s})();